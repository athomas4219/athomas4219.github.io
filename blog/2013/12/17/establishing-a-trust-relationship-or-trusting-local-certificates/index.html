
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Establishing a Trust Relationship or Trusting Local Certificates - Andrew Thomas' Blog</title>
  <meta name="author" content="Andrew Thomas">

  
  <meta name="description" content="At work, the certificates in our lab environment are signed by a local certificate authority. Additionally, we do not have the lab intermediate &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.at-dot.net/blog/2013/12/17/establishing-a-trust-relationship-or-trusting-local-certificates">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Andrew Thomas' Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Andrew Thomas' Blog</a></h1>
  
    <h2>Like we need another blog</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.at-dot.net" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Establishing a Trust Relationship or Trusting Local Certificates</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-12-17T09:52:17-05:00" pubdate data-updated="true">Dec 17<span>th</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>At work, the certificates in our lab environment are signed by a local certificate authority. Additionally, we do not have the lab intermediate certificate authorities on our local workstations. This means that when we call WCF or REST services we sometimes see the following error:</p>

<pre><code>Could not establish trust relationship for the SSL/TLS secure channel with authority 'someserver.whereiwork.com'.
</code></pre>

<p>This error can be resolved either by importing the intermediate certificate authorities on your workstation, or by using the following code.</p>

<p>Please note that this code should only be executed <strong>once</strong> in your application (<code>global.asax</code>) and <strong>never</strong> in a production environment because it short circuits the protection offered by the PKI.</p>

<p>C#:</p>

<figure class='code'><figcaption><span>C# </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="cp">#if DEBUG</span>
</span><span class='line'>  <span class="n">ServicePointManager</span><span class="p">.</span><span class="n">ServerCertificateValidationCallback</span> <span class="p">+=</span> <span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">cert</span><span class="p">,</span> <span class="n">chain</span><span class="p">,</span> <span class="n">sslPolicyErrors</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'><span class="cp">#endif</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you have to do this in Visual Basic, use the following:</p>

<figure class='code'><figcaption><span>VB.NET </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='vbnet'><span class='line'><span class="cp">#If DEBUG Then</span>
</span><span class='line'>  <span class="n">ServicePointManager</span><span class="p">.</span><span class="n">ServerCertificateValidationCallback</span> <span class="o">=</span> <span class="ow">AddressOf</span> <span class="n">AcceptAllCertificates</span>
</span><span class='line'><span class="cp">#End If</span>
</span><span class='line'>
</span><span class='line'><span class="k">Private</span> <span class="k">Function</span> <span class="nf">AcceptAllCertificates</span><span class="p">(</span><span class="k">ByVal</span> <span class="n">sender</span> <span class="ow">As</span> <span class="kt">Object</span><span class="p">,</span> <span class="k">ByVal</span> <span class="n">cert</span> <span class="ow">As</span> <span class="n">X509Certificate</span><span class="p">,</span> <span class="k">ByVal</span> <span class="n">chain</span> <span class="ow">As</span> <span class="n">X509Chain</span><span class="p">,</span> <span class="k">ByVal</span> <span class="n">sslPolicyErrors</span> <span class="ow">As</span> <span class="n">SslPolicyErrors</span><span class="p">)</span> <span class="ow">As</span> <span class="kt">Boolean</span>
</span><span class='line'>    <span class="k">Return</span> <span class="k">True</span>
</span><span class='line'><span class="k">End</span> <span class="k">Function</span>
</span></code></pre></td></tr></table></div></figure>



</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Andrew Thomas</span></span>

      








  


<time datetime="2013-12-17T09:52:17-05:00" pubdate data-updated="true">Dec 17<span>th</span>, 2013</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://blog.at-dot.net/blog/2013/12/17/establishing-a-trust-relationship-or-trusting-local-certificates/" data-via="athomas4219" data-counturl="http://blog.at-dot.net/blog/2013/12/17/establishing-a-trust-relationship-or-trusting-local-certificates/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
      
        <a class="basic-alignment right" href="/blog/2013/12/18/installing-the-electric-plum-iphone-simulator-in-visual-studio-2013/" title="Next Post: Installing the Electric Plum iPhone Simulator in Visual Studio 2013">Installing the Electric Plum iPhone Simulator in Visual Studio 2013 &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/04/16/resizing-the-screen-resolution-in-ubuntu-when-you-cant-see-the-apply-button/">Resizing the Screen Resolution in Ubuntu When You Can't See the Apply Button</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/15/outlook-has-left-the-building/">Outlook Has Left the Building</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/12/29/entity-framework-6-specifying-a-connectionstring-in-code/">Entity Framework 6: Specifying a ConnectionString in Code</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/12/25/adding-google-authentication-with-dotnetopenauth/">Adding Google Authentication With DotNetOpenAuth</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/12/18/installing-the-electric-plum-iphone-simulator-in-visual-studio-2013/">Installing the Electric Plum iPhone Simulator in Visual Studio 2013</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/athomas4219">@athomas4219</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'athomas4219',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Andrew Thomas -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'andrewthomasblog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://blog.at-dot.net/blog/2013/12/17/establishing-a-trust-relationship-or-trusting-local-certificates/';
        var disqus_url = 'http://blog.at-dot.net/blog/2013/12/17/establishing-a-trust-relationship-or-trusting-local-certificates/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
